{% extends "bootstrap/base.html" %}
{% block styles %}
{{super()}}
<link rel="stylesheet" href="{{url_for('.static', filename='style.css')}}">
<link rel="stylesheet" href="{{url_for('.static', filename='nofar.css')}}">
{% endblock %}

{% block scripts %}
	{{super()}}
	<script type="text/javascript" src="{{ url_for('static', filename='scripts/jquery.mobile.custom.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='scripts/main.js') }}"></script>
	<script>
		$(document).ready(function() {
			var task_htmls = {}
			var new_task_htmls = {}
			var panel_heading_styles = ["YELLOWBOX", "PINKBOX", "BLUEBOX", "GREENBOX", "DARKBLUEBOX"]
			var panel_title_styles = ["NormalCharacterStyle4", "NormalCharacterStyle4", "NormalCharacterStyle4", "NormalCharacterStyle4", "NormalCharacterStyle4"]
			var panel_value_styles = ["NormalCharacterStyle5", "NormalCharacterStyle5", "NormalCharacterStyle5", "NormalCharacterStyle5", "NormalCharacterStyle5"]
			var task_title_styles = ["NormalCharacterStyle8", "NormalCharacterStyle8", "NormalCharacterStyle8", "NormalCharacterStyle8", "NormalCharacterStyle7"]
			var panel_body_styles = ["YELLOWBOX", "PINKBOX", "BLUEBOX", "GREENBOX", "DARKBLUEBOX"]
			var panel_footer_styles = ["YELLOWBOX", "PINKBOX", "BLUEBOX", "GREENBOX", "DARKBLUEBOX"]
			var task_type_index = 0
			$("#creation-alert").fadeOut(2000);
			console.debug("max_id = {{num_tasks}}")
			{% for task_type in tasks %}
				{
					console.debug("task_type = {{task_type}}, length = {{ tasks[task_type]|length}}")
					var carousel_content = ""
					new_task_htmls["{{task_type}}"] =  '<div class="item" id="create_{{task_type}}">\
						<div class="panel-group">\
							<div class="' + panel_heading_styles[task_type_index] + ' panel panel-default">\
								<div class="' + panel_heading_styles[task_type_index] + ' panel-heading">\
									<h4 class="' + panel_title_styles[task_type_index] + ' panel-title">\
										<a data-toggle="collapse" href="#collapse_1_end">CREATE A TASK!</a>\
									</h4>\
								</div>\
								<div id="collapse_1_end" class="panel-collapse collapse">\
									<div class="' + panel_body_styles[task_type_index] + ' panel-body">Create a new task for others to enjoy</div>\
								</div>\
							</div>\
						</div>\
					</div>'
					task_htmls["{{task_type}}"] = []
					{% for task in tasks[task_type] %}
						task_htmls["{{task_type}}"].push('<div class="item" id="task_{{task.task_id}}">\
								<div class="panel-group">\
									<div class="' + panel_heading_styles[task_type_index] + ' panel panel-default">\
										<div class="' + panel_heading_styles[task_type_index] + ' panel-heading">\
											<h4 class="align_right panel-title">\
												<div class="' + panel_value_styles[task_type_index]+ '_small"><br><br></div>\
												<div class="' + panel_value_styles[task_type_index]+ '">' + {{ task["value"] }} + '</div>\
												<div class="' + panel_value_styles[task_type_index]+ '_small">Shmekels</div>\
											</h4>\
											<div class="table_crap">\
												<h4 class="align_top panel-title">\
													<a class="' + panel_title_styles[task_type_index] + '" data-toggle="collapse" href="#collapse_' + task_type_index + '_{{loop.index0}}">' + '{{ task["title"] }}'.toUpperCase() + '</a>\
												</h4>\
												<h4 class="align_bottom panel-title">\
													<div class="' + task_title_styles[task_type_index] + '">' + '{{task_type}}'.toUpperCase() + '</div>\
												</h4>\
											</div>\
										</div>\
										<div id="collapse_' + task_type_index + '_{{loop.index0}}" class="panel-collapse collapse">\
											<div class="' + panel_body_styles[task_type_index] + ' panel-body">\
											<table class="table borderless">\
													<tbody>\
													  <tr>\
														<td class="td-center"><span class="details-icon glyphicon glyphicon-option-horizontal"></span></td>\
														<td>{{ task["description"] }}</td>\
													  </tr>\
													  <tr>\
														<td class="td-center"><span class="details-icon glyphicon glyphicon-thumbs-up"></span></td>\
														<td>done by 145 people</td>\
													  </tr>\
													  <tr>\
														<td class="td-center"><span class="details-icon glyphicon glyphicon-road"></span></td>\
														<td>{{ task["in_out_everywhere"] }}</td>\
													  </tr>\
													  <tr>\
														<td class="td-center"><span class="details-icon glyphicon glyphicon-time"></span></td>\
														<td>{{ task["duration"] }}</td>\
													  </tr>\
													</tbody>\
												  </table>\</div>\
										</div>\
									</div>\
								</div>\
							</div>')
					{% endfor %}
					carousel_content = '<div id="' + task_type_index + 'Carousel" class="carousel slide" data-interval="">\
											<div class="carousel-inner">'
					for (i = 0; i < task_htmls["{{task_type}}"].length; i++) {
						carousel_content += task_htmls["{{task_type}}"][i];
					}
					carousel_content += new_task_htmls["{{task_type}}"] + '</div></div>'
					$(".container").html($(".container").html() + carousel_content)
					$("#" + task_type_index + "Carousel").find(".carousel-inner").find(".item").first().addClass('active');
					task_type_index += 1;
				}
			{% endfor %}
			task_type_index = 0
			var ended = {}
			{% for task_type in tasks %}
				{
					ended["{{task_type}}"] = false
					$("#" + task_type_index + "Carousel").on("slid.bs.carousel", function (evt) {
						console.debug("slide transition ended")
						//console.debug("current slide = ", $(this).find(".active").index())
						console.debug("next slide = ", $(evt.relatedTarget).index() )
						console.debug("length = ", task_htmls["{{task_type}}"].length )
						if ($(evt.relatedTarget).index() == task_htmls["{{task_type}}"].length && !ended["{{task_type}}"]) {
							console.debug("ended")
							$(this).find(".carousel-inner").html(new_task_htmls["{{task_type}}"] + new_task_htmls["{{task_type}}"])
							$(this).find(".carousel-inner").find(".item").first().addClass('active');
							ended["{{task_type}}"] = true
						}
					})
					task_type_index += 1;
				}
			{% endfor %}
			
			$(".carousel-inner").swiperight(function() {
				$(this).parent().carousel('prev');
				var task_id = $(this).find(".active").attr('id')
				var addr;
				if (task_id.replace("task_", "") != task_id) {
					addr = "{{url_for('do', task_id='ttt')}}".replace("ttt", task_id.replace("task_", ""))
				} else {
					addr = "{{url_for('create')}}"
				}
				window.location.href = addr;
			});
			$(".carousel-inner").swipeleft(function() {
				$(this).parent().carousel('next');
			});
			$("#do").click(function() {
				window.location.replace("{{url_for('do', task_id=12)}}");
			});
			$("#create").click(function() {
				window.location.replace("{{url_for('create')}}");
			});
		});
	</script>
{% endblock %}
{% block title %}
	Positask - Happiness, one task at a time
{% endblock %}

{% block content %}
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                </button>
            </div>
            <div class="navbar-header" style="position:absolute; height: 100%; margin:0 auto;">
                <a href="default.asp">
                    <img src="{{url_for('.static', filename='icons/plus.svg')}}" style="width:100%;height:100%;border:0;">
                </a>
            </div>
            <div class="navbar-header" style="position:absolute; width: 100%; height: 100%; left: 0; top: 0; text-align: center; margin:0 auto;">
                <a href="/">
                    <img src="{{url_for('.static', filename='icons/pooosi.svg')}}" style="width:100%;height:100%;border:0;">
                </a>
            </div>


            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="{{url_for('.static', filename='icons/menu.svg')}}" style="width:100%;height:100%;border:0;"> <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Separated link</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>



{#    <div class="row text-center" role="group" aria-label="Button group with nested dropdown">#}
{##}
{#        <button type="button" class="btn btn-secondary col-md-1">#}
{#            <img width="20" src="static/icons/plus.svg"/>#}
{#        </button>#}
{##}
{#        <button type="button" class="btn btn-secondary col-md-10">#}
{#            <img  width="80" src="static/icons/pooosi.svg">#}
{#        </button>#}
{##}
{#        <div class="btn-group col-md-1" role="group">#}
{#            <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
{#                <img width="20"  src="static/icons/menu.svg">#}
{#            </button>#}
{#            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1" style="max-width:80px">#}
{#                <a class="dropdown-item" type="button">Explore Tasks</a>#}
{#                <a class="dropdown-item" type="button">Create a Task</a>#}
{#                <a class="dropdown-item" type="button">Settings</a>#}
{#                <a class="dropdown-item" type="button">Notifications</a>#}
{#                <a class="dropdown-item" type="button">About</a>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}


    {% for message in get_flashed_messages() %}
		<div id="creation-alert" class="alert alert-success">
		  <strong>{{ message }}</strong>
		</div>
    {% endfor %}

	<div class="container">
	</div>
{% endblock %}
